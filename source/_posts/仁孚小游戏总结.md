# 项目经验总结(问题+解决方法)

### 1.仁孚小游戏

##### 1.1 loading页面预加载问题

+ 字体图片加载

+ 问题描述：在loading页面加载的途中要把项目内所用到的资源先加载出来，避免出现留白卡顿的地方，提 升用户的体验

+ 问题解决方案：使用 loadjs 包裹预加载的内容   缺点：不能预加载音频视频

  ```js
  具体用法：
  
  npm install --save loadjs
  
  var loadjs = require('loadjs');
  
  //需要等待加载的文件
  loadjs(['/path/to/foo.js', '/path/to/bar.js'], 'foobar');
  
  //加载完成后执行的代码
  loadjs.ready('foobar', {
    success: function() { /* foo.js & bar.js loaded */ },
    error: function(depsNotFound) { /* foobar bundle load failed */ }
  });
  
  ```
  
  

+ 音频加载

  ```js
  a方案：可以在标签上设置预加载属性
  <audio src='./audio/bg.mp3' autoplay='autoplay' loop preload='auto' id='sendid2'></audio>
  
  b方案：创建音乐再预加载
  // 预加载的音乐
  var music = document.createElement("audio");
      music.src = "音乐地址"; //放线上地址会更快
      music.loop=true;
  var isOnce =0 //一个控制变量控制事件只执行一次
  
  music.load()//加载音乐
  // canplaythrough 判断音乐能否完整播放，注意此事件在苹果，安卓手机上支持不同需要慎用
  music.addEventListener("canplaythrough",
                  function() {
                      if(isOnce==0){ 
                          $('.loading').hide();
                          showMain();
                          isOnce++
                       }
                  },false);
  ```

  

##### 1.2 移动端适配问题

+ 背景图片适配

```js
  1.拿到设计图之前先分析要不要分层很大的背景图片放在最下面，上面的有变动的作为单独的小块定位或者其他方法使其对应到相应位置
  
  2.切记，先分析好再动手，谨慎使用定位
```

  

+ 部分图标按钮适配

  ```js
  1.不同的机型要考虑1比1还原设计图，思想就是在大屏手机上图片尺寸大一点，小手机图片尺寸小一点，这里需要灵活的运用 vw、vh、px、rem等单位，必要时候需要用到媒体查询，在不同的尺寸下设置样式，就可以基本保证图标按钮随着机型的不同而不同
  媒体查询：
  @media screen and (max-width:大小 ){} 大到小
  @media screen and (min-width:大小 ){}   小到大
  @media screen and (min-width:大小 ) and (max-width:大小 ){}
  ```

  

  ##### 1.3 真机预览

  ```js
  1.运行项目，手机和项目在同一个局域网下，进入项目地址即可在手机上浏览
  
  2.项目手机浏览注意以下几点
  	a.页面有没有按设计图正常显示(不出现过度变形，文字超出相应区域，字体样式，按钮字体行高等等)
  
  	b.页面有没有出现遮挡文字情况，图标遮挡相应文字，相应画面，字体大小颜色样式是否还原设计图
  
  	c.功能的实现，预加载的页面完成后相应的内容有没有出现，页面之间的跳转有没有问题，页面的功能有没	有问题
      
      d.安卓和ios或许有区别和兼容性问题（重点）
  
  	e.如果是手打的文字，注意逐字逐句排查有无错别字
  ```

  

  ##### 1.4 打包问题

  ```js
  a、webpack文件夹
      线上地址：publicPath
      对应的index配置: 要看index名字和主目录下的文件名字是否相同
  
  b、全局配置的js文件（common.js）
      PROJECTUSER:这里存放的是 localstorage，每次都要不一样
      
      微信分享信息：url可能会变（取决于webpack 里的配置）
      
      获取用户信息：GetUserInfo：获取用户信息（注意放开注释）
      
      获取code：GetCode：去微信拿code（注意放开注释）
  
  c、index.html 文件
  	注意index文件名是否与webpack配置一致
      
  	注意引入的js、css文件等是否是相应的地址
  
  d、打包命令
  	在本机运行：dev
  	打包给后台：build
  
  ```

  

### 2.h5页面

##### 2.1 布局紊乱，背景图片过大

+ 问题描述：在自己ps抠图的过程中，要考虑到扣下来的图片是否体积太大，如果太大会导致在加载时间变				   长，用户体验不好，布局紊乱多是定位的使用不得当
+ 问题解决方案：需要用到压缩工具将对应图片压缩小

```js
1、一个压缩png图片的网站：
	https://tinypng.com/  

2、布局时，在移动端先考虑 flex 布局，会轻松很多，慎用定位
```



##### 2.2 vue中的微信分享(不含获取用户信息)

```js

1、不需要获取用户信息的微信分享
注意接口的修改

a.在 html 中加入标签
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>

b.创建一个关于微信的分享配置文件 可以在 assets/js 下创建
import {WECHAT_CONFIG} from '../../utils/apiList'
import http from '../../utils/http'

export function wxConfig(apiList) {
    var path = 'http://infomgr.mind-node.com' + WECHAT_CONFIG;
    var data = "?url=" + encodeURIComponent(window.location.href) + "&sign=sign";
    http.get(WECHAT_CONFIG + data).then(res => {
        if(res) {
            let resData = JSON.parse(res.data)
            console.log(resData)
            let signInfo = JSON.parse(resData.signInfo)
            console.log(signInfo)
            wx.config({
                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId: signInfo.appId, // 必填，公众号的唯一标识
                timestamp: signInfo.timestamp, // 必填，生成签名的时间戳
                nonceStr: signInfo.noncestr, // 必填，生成签名的随机串
                signature: signInfo.signature, // 必填，签名，见附录1
                jsApiList: apiList // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
            });
        }
    })
    
/**
微信分享信息
*/
var shareOptions = {
    url: "http://h5.mind-node.com/info/index.html",
    title: "辽宁省暨沈阳市提信心·促销费活动",
    imgUrl: "https://mind-node.oss-cn-beijing.aliyuncs.com/leave_message/share.jpg",//转发图标
    desc: "权威信息发布平台",
}
export function createShare(options) {
    options = options || {};
    wx.onMenuShareAppMessage({ //分享给好友
        title: options.title || "", // 分享标题
        link: options.url || "", // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
        imgUrl: options.imgUrl || "", // 分享图标
        desc: options.desc || "",
    });
    wx.onMenuShareTimeline({ //发送到朋友圈
        title: options.title || "", // 分享标题
        link: options.url || "", // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
        imgUrl: options.imgUrl || "", // 分享图标
        desc: options.desc || "",
    });
}

c.在app.vue里面引入配置
import {wxConfig} from '../src/assets/js/wx'
在created生命周期里调用
wxConfig(['onMenuShareTimeline', "onMenuShareAppMessage", "hideMenuItems"]);

d.在主页面index.vue created生命周期里调用wx.ready
    wx.ready(function() {
        createShare({
            url: "http://h5.mind-node.com/info/index.html",
            title: "辽宁省暨沈阳市提信心·促销费活动",
            imgUrl: "https://mind-node.oss-cn-beijing.aliyuncs.com/leave_message/share.jpg",//转发图标
            desc: "权威信息发布平台",
        });
    })


```

##### 2.3 ios 输入框弹起问题

+ 问题描述：在ios中的输入框输入时键盘弹起会将页面往上顶，并且键盘收起后页面不会回弹
+ 问题解决方案：在结束输入后让页面滚动回来

```js
jQuery中：
//在全局js中加入
$('input, textarea').on('blur',function(){
  // 滚动到顶部
  window.scroll(0,0);
  // 滚动到底部
  window.scrollTo(0, document.documentElement.clientHeight);
});


vue中:
1.绑定focus事件
 <input type="text" placeholder="信息发布单位/企业名称" @focus="getFocus" v-model="unitname">
 
 2.添加函数
   methods:{
       getFocus:function(){
           window.addEventListener('focusout', function () {
           // 滚动到顶部
           window.scroll(0,0);
           // 滚动到底部
           window.scrollTo(0, document.documentElement.clientHeight);
      })
    }
   }
```

##### 2.4 将后台返回的毫秒时间转化为年月日

+ 问题描述：后台返回的时间格式多是毫秒值，和日常生活中使用的时间习惯不同
+ 问题解决方案：使用一个函数对时间格式重新写入

```js
//对应渲染位置调用该函数
handleTime(time){
  var date = new Date(time);
  var month = date.getMonth() + 1;
  var day = date.getDate();
  if (month < 10) {
   month = month + "月";
  }
  if (day < 10) {
   day = day + "日";
  }
  var str = "" + year + month + day
  return str;
  }
```

##### 2.5 在vue项目里实现上下滑动翻页

+ 问题描述：手机h5页面多是上下滑动翻页，用户体验会更好
+ 问题解决方案：使用类似滑动轮播图的形式，将页面分为一页一页的单独滑动页面

```js
//这里使用的是 swiper 实现功能
1.打好vue-cli项目，安装vue-awesome-swipe
npm i --s vue-awesome-swiper

2.main.js 中引入
import VueAwesomeSwiper from 'vue-awesome-swiper'
import 'swiper/dist/css/swiper.css'
Vue.use(VueAwesomeSwiper)

3.一般是在主页中有下面的操作
3.1组件中写上swiper结构
<transition name="fade">
    <swiper id="swiperBox" v-bind:options="swiperOption" ref="mySwiper">
        <!-- 第一页 -->
        <swiper-slide class="swiper-slide1">
            <div class="page">
                <home></home>
			</div>
		</swiper-slide>
		<!-- 第二页 -->
        <swiper-slide class="swiper-slide2">
            <div class="page">
                 <statistics></statistics>
            </div>
        </swiper-slide>
        <!-- 第三页 -->
        <swiper-slide class="swiper-slide3">
             <div class="page">
                 <enterprise></enterprise>
             </div>
         </swiper-slide>
         <!-- 第四页 -->
         <swiper-slide class="swiper-slide4">
              <div class="page">
                  <congratulation></congratulation>
              </div>
          </swiper-slide>
    </swiper>
</transition>

3.2 引入swiper组件
import { swiper, swiperSlide } from 'vue-awesome-swiper'

3.3 注册组件
components:{
      home,//第1页内容组件
      statistics,//第2页内容组件
      enterprise,//第3页内容组件
      congratulation,//第4页内容组件
          
      swiper,
      swiperSlide,
  }
    
3.4 swiper配置,具体更详细配置可参考swipei中文官网： https://www.swiper.com.cn/
    
data () {
    return {
        swiperOption: {
            // swiper configs 所有的配置同swiper官方api配置
            notNextTick: true,//notNextTick是一个组件自有属性，如果notNextTick设置为true，组件则不会通过NextTick来实例化swiper，也就意味着你可以在第一时间获取到swiper对象，假如你需要刚加载遍使用获取swiper对象来做什么事，那么这个属性一定要是true
            direction: 'vertical',//垂直方向移动
            grabCursor: true,//鼠标覆盖Swiper时指针会变成手掌形状，拖动时指针会变成抓手形状
            setWrapperSize: true,//Swiper使用flexbox布局(display: flex)，开启这个设定会在Wrapper上添加等于slides相加的宽或高，在对flexbox布局的支持不是很好的浏览器中可能需要用到。
            autoHeight: true,//自动高度。设置为true时，wrapper和container会随着当前slide的高度而发生变化
            slidesPerView: 1,//设置slider容器能够同时显示的slides数量(carousel模式)。可以设置为数字（可为小数，小数不可loop），或者 'auto'则自动根据slides的宽度来设定数量。loop模式下如果设置为'auto'还需要设置另外一个参数loopedSlides。
            mousewheel: false,//开启鼠标滚轮控制Swiper切换。可设置鼠标选项，默认值false
            mousewheelControl: false,//同上
            height: window.innerHeight, // 高度设置，占满设备高度
            resistanceRatio: 0,//抵抗率。边缘抵抗力的大小比例。值越小抵抗越大越难将slide拖离边缘，0时完全无法拖离。本业务需要
            observeParents: true,//将observe应用于Swiper的父元素。当Swiper的父元素变化时，例如window.resize，Swiper更新
    
            // 如果自行设计了插件，那么插件的一些配置相关参数，也应该出现在这个对象中，如下debugger
            debugger: true,
    
            // swiper的各种回调函数也可以出现在这个对象中，和swiper官方一样
            onTransitionStart(swiper){
                console.log(swiper)
            }
        }
    }
  },

```

##### 2.6 微信h5页面产生导航栏问题

+ 问题描述：在微信h5页面路由跳转的时候有时候会产生一个微信导航栏挤压页面，影响内容展示
+ 问题产生原因： 底部导航栏是因为出现`history记录`才出现的，使用replace就没有history记录，所以就可以完美隐藏导航栏了 

```js
// 解决办法
统一将路由跳转方式由：
this.$router.push('/path'})

改为：
this.$router.replace('/path')
```

